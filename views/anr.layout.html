<div flex ng-controller="AnrLayoutCtrl" md-theme="light">
    <div layout="column" layout-align="center center" ng-if="!model" flex class="md-padding">
        <md-progress-circular md-indeterminate="true"></md-progress-circular>
    </div>

    <div layout="column" ng-if="model" md-theme="light" class="md-padding-left md-padding-right">
        <h2>{{ ::model.label1 }}</h2>

        <md-card>
            <md-tabs md-border-bottom="true" md-dynamic-height>
                <md-tab label="{{ 'Risk analysis' | translate }}">
                    <div layout="row" class="md-padding">
                        <div layout="column" resizable r-directions="['right']">
                            <md-button ui-sref="main.kb_mgmt.models.details({modelId: model.id})" ng-if="OFFICE_MODE == 'BO'" style="margin:0 0 8px 0;"><md-icon>home</md-icon> {{ model.anr.label1 }}</md-button>
                            <md-button ui-sref="main.project.anr({modelId: model.id})" ng-if="OFFICE_MODE == 'FO'" style="margin:0 0 8px 0;"><md-icon>home</md-icon> {{ 'Risk analysis overview' | translate }}</md-button>

                            <md-subheader class="md-no-sticky md-small-subheader">
                                <div layout="row" layout-align="space-between center">
                                    <div translate>Risk analysis</div>
                                    <md-button class="md-icon-button" ng-click="uiState.hideInstances = !uiState.hideInstances"><md-icon>{{ uiState.hideInstances ? 'expand_more' : 'expand_less' }}</md-icon></md-button>
                                </div>
                            </md-subheader>

                            <div layout="column" ng-hide="uiState.hideInstances" resizable r-directions="['bottom']">
                                <md-input-container class="md-block">
                                    <md-icon>search</md-icon>
                                    <label translate>Search an instance...</label>
                                    <input type="text" ng-model="filter.instance"  flex="80">
                                </md-input-container>

                                <div class="angular-ui-tree" ui-tree="insTreeCallbacks" data-drag-delay="100">
                                    <div layout="row" layout-align="center center" ng-if="!anr_obj_instances_data">
                                        <md-progress-circular md-diameter="24"></md-progress-circular>
                                    </div>

                                    <ol class="no-list-style" ui-tree-nodes="" ng-model="anr_obj_instances_data" id="inst-tree-root">
                                        <li ng-repeat="node in anr_obj_instances_data" ui-tree-node ng-include="'tree_node_renderer.html'"></li>
                                    </ol>
                                </div>
                            </div>

                            <md-subheader class="md-no-sticky md-small-subheader" style="z-index: 8">
                                <div layout="row" layout-align="space-between center">
                                    <div translate>Objects library</div>
                                    <md-button class="md-icon-button" ng-click="uiState.hideLibrary = !uiState.hideLibrary"><md-icon>{{ uiState.hideLibrary ? 'expand_more' : 'expand_less' }}</md-icon></md-button>
                                </div>
                            </md-subheader>

                            <div layout="column" ng-hide="uiState.hideLibrary" style="background:white; z-index: 10">
                                <div layout="row" layout-align="center center">
                                    <md-input-container class="md-block" flex>
                                        <md-icon>search</md-icon>
                                        <label translate>Search an object...</label>
                                        <input type="text" ng-model="filter.library">
                                    </md-input-container>
                                    <md-button class="md-icon-button" ng-click="addObject($event)"><md-icon>add</md-icon></md-button>
                                </div>

                                <div class="angular-ui-tree" ui-tree="libTreeCallbacks" data-drag-delay="100">
                                    <div layout="row" layout-align="center center" ng-if="!anr_obj_library_data">
                                        <md-progress-circular md-diameter="24"></md-progress-circular>
                                    </div>
                                    <ol class="no-list-style" ui-tree-nodes="" ng-model="anr_obj_library_data" id="objlib-tree-root">
                                        <li ng-repeat="node in anr_obj_library_data" ui-tree-node ng-include="'tree_node_renderer.html'"></li>
                                    </ol>
                                </div>
                            </div>

                        </div>

                        <div flex ui-view="anr" style="background:white; z-index: 15; margin-left: 8px;"></div>
                    </div>

                </md-tab>

                <md-tab label="{{ 'Evaluation scales' | translate }}">
                    <div class="md-padding-left md-padding-right" layout="column">
                        <div layout="row">
                            <h4><span translate>Impacts scale:</span> [
                                <span class="small text-blue" inline-edit="scales.impacts.min" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-validation="inlineNumberValidator(newValue)" inline-edit-on-click></span> -
                                <span class="small text-blue" inline-edit="scales.impacts.max" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-validation="inlineNumberValidator(newValue)" inline-edit-on-click></span> ]
                            </h4>
                        </div>
                        <md-switch ng-model="display.show_hidden_impacts">{{ 'Show hidden impacts' }}</md-switch>

                        <div class="horz-expanding-table">
                            <table class="md-html-table">
                                <thead>
                                <tr>
                                    <th></th>
                                    <th ng-if="!type.isHidden || display.show_hidden_impacts" ng-repeat="type in scales_types">{{ type.label1 }} <md-button class="md-icon-button" ng-click="setImpactVisibility(type.id, !!type.isHidden)"><md-icon>{{ type.isHidden ? 'visibility_off' : 'visibility' }}</md-icon></md-button></th>
                                    <th><span inline-edit="newColumn.name" inline-edit-callback="onCreateNewColumn(newValue)" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-on-click inline-edit-placeholder="{{ 'New column name' | translate }}"></span></th>
                                </tr>
                                </thead>

                                <tbody>
                                <tr ng-repeat="i in range(scales.impacts.min, scales.impacts.max)">
                                    <th>{{ i }}</th>
                                    <td ng-if="!type.isHidden || display.show_hidden_impacts" ng-repeat="type in scales_types"><span inline-edit="comms.impact[i][type.id].comment1" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-on-click inline-edit-textarea inline-edit-placeholder="{{ 'Click here to type...' | translate }}"></span></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <h4><span translate>Threats scale:</span> [
                            <span class="small text-blue" inline-edit="scales.threats.min" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-validation="inlineNumberValidator(newValue)" inline-edit-on-click></span> -
                            <span class="small text-blue" inline-edit="scales.threats.max" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-validation="inlineNumberValidator(newValue)" inline-edit-on-click></span> ]
                        </h4>

                        <ul class="no-list-style">
                            <li ng-repeat="i in range(scales.threats.min, scales.threats.max)">{{i}}. <span class="large" inline-edit="comms.threat[i].comment1" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-on-click inline-edit-textarea inline-edit-placeholder="{{ 'Click here to type...' | translate }}"></span></li>
                        </ul>

                        <h4><span translate>Vulnerabilities scale:</span> [
                            <span class="small text-blue" inline-edit="scales.vulns.min" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-validation="inlineNumberValidator(newValue)" inline-edit-on-click></span> -
                            <span class="small text-blue" inline-edit="scales.vulns.max" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-validation="inlineNumberValidator(newValue)" inline-edit-on-click></span> ]
                        </h4>

                        <ul class="no-list-style">
                            <li ng-repeat="i in range(scales.vulns.min, scales.vulns.max)">{{i}}. <span class="large" inline-edit="comms.vuln[i].comment1" inline-edit-btn-edit="" inline-edit-on-blur="save" inline-edit-on-click inline-edit-textarea inline-edit-placeholder="{{ 'Click here to type...' | translate }}"></span></li>
                        </ul>

                        <h4 translate>Thresholds</h4>

                        <div layout="row">
                            <div layout="column" flex="50">
                                <h5 translate>Max risks thresholds</h5>
                                <div layout="row" layout-align="start center">
                                    <div class="anr-scales-demo-block green"></div>
                                    <md-input-container>
                                        <input type="number" min="0" max="128" ng-model="thresholds.thresholds.min" aria-label="min" />
                                    </md-input-container>
                                </div>

                                <div layout="row" layout-align="start center">
                                    <div class="anr-scales-demo-block orange"></div>
                                    <md-input-container>
                                        <input type="number" min="0" max="128" ng-model="thresholds.thresholds.max" aria-label="max" />
                                    </md-input-container>
                                </div>
                            </div>

                            <div layout="column" flex="50">
                                <h5 translate>Max ROLF thresholds</h5>
                                <div layout="row" layout-align="start center">
                                    <div class="anr-scales-demo-block green"></div>
                                    <md-input-container>
                                        <input type="number" min="0" max="128" ng-model="thresholds.rolf_thresholds.min" aria-label="min" />
                                    </md-input-container>
                                </div>

                                <div layout="row" layout-align="start center">
                                    <div class="anr-scales-demo-block orange"></div>
                                    <md-input-container>
                                        <input type="number" min="0" max="128" ng-model="thresholds.rolf_thresholds.max" aria-label="max" />
                                    </md-input-container>
                                </div>
                            </div>
                        </div>

                    </div>
                </md-tab>
            </md-tabs>
        </md-card>
    </div>
</div>


<script type="text/ng-template" id="tree_node_renderer.html">
    <div ui-tree-handle layout="row" layout-align="start center">
        <md-button class="md-icon-button md-tree-unwrap-button" ng-click="toggle(this)" ng-if="node.type == 'libcat' || node.__children__.length > 0" ng-disabled="node.__children__.length == 0" data-nodrag>
            <md-icon>{{ (collapsed || node.__children__.length == 0) ? 'expand_less' : 'expand_more' }}</md-icon>
        </md-button>

        <div class="md-tree-unwrap-button" ng-if="!(node.type == 'libcat' || node.__children__.length > 0)">&nbsp;</div>

        <p flex class="md-tree-link" ng-click="toggle(this)" ng-if="node.type == 'libcat'">{{ node.label1 }}</p>
        <p flex class="md-tree-link" ng-class="{'active-obj': node.type == 'lib' && node.id == anr_selected_object_id}" ui-sref="main.project.anr.object({objectId: node.id})" ng-if="node.type == 'lib' && OFFICE_MODE == 'FO'">{{ node.name1 }}</p>
        <p flex class="md-tree-link" ng-class="{'active-inst': node.type == 'inst' && node.id == anr_selected_instance_id}" ui-sref="main.project.anr.instance({instId: node.id})" ng-if="node.type == 'inst' && OFFICE_MODE == 'FO'">{{ node.name1 }}</p>
        <p flex class="md-tree-link" ng-class="{'active-obj': node.type == 'lib' && node.id == anr_selected_object_id}" ui-sref="main.kb_mgmt.models.details.object({objectId: node.id})" ng-if="node.type == 'lib' && OFFICE_MODE == 'BO'">{{ node.name1 }}</p>
        <p flex class="md-tree-link" ng-class="{'active-inst': node.type == 'inst' && node.id == anr_selected_instance_id}" ui-sref="main.kb_mgmt.models.details.instance({instId: node.id})" ng-if="node.type == 'inst' && OFFICE_MODE == 'BO'">{{ node.name1 }}</p>

        <md-icon ng-if="node.scope == 2" style="font-size: 15px; padding-top: 5px;">share</md-icon>
    </div>

    <ol class="no-list-style" ui-tree-nodes="" ng-model="node.__children__" ng-show="!collapsed">
        <li ng-repeat="node in node.__children__" ui-tree-node ng-include="'tree_node_renderer.html'" ng-show="visible(node)"></li>
    </ol>
</script>